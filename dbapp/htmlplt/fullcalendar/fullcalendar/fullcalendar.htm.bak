<html>
<head>
  <title>Custom Layouts and Containers - Portal Sample</title>
<LINK rel=stylesheet type=text/css href="/msa/extjs/resources/css/ext-all.css">
<link rel="stylesheet" type="text/css" href="/msa/extjs/resources/css/xtheme-default.css">
<script type="text/javascript" src="/msa/extjs/adapter/ext/ext-base.js"></script>
<SCRIPT type=text/javascript  src="/msa/extjs/ext-all.js"></SCRIPT>

<script type="text/javascript" src="/msa/extjs/Portal.js"></script>
<script type="text/javascript" src="/msa/extjs/PortalColumn.js"></script>
<link rel="stylesheet" type="text/css" href="/msa/extjs/resources/css/portal.css" />
<link rel="stylesheet" type="text/css" href="/msa/extjs/resources/css/sample.css" />
<style type="text/css">
#mytable{
	width: 300px;
	padding: 0;
	margin: 0;
}
#mytable td {
	width: 150px;
	border-right: 1px solid #C1DAD7;
	border-bottom: 1px solid #C1DAD7;
	background: #fff;
	font-size:11px;
	padding: 2px 2px 2px 2px;
	color: #4f6b72;
}
</style>
<SCRIPT type=text/javascript>
	function showwin(url){
					var mywin =new Ext.Window(
          {
                id: 'panel',
                title: '数据详情',
                closeAction: 'close',
                height:550,
                width:650,
                modal: 'true',
                maximizable:'true',
                margins:'0 5 0 0',
                html: "<IFRAME  name='menufrm' width=100% height='100%' SRC = '"+url+"'  border='0' frameborder='0' scrolling='yes'></iframe>"
          });
          mywin.show();
          mywin.maximize();
	}
	Date.prototype.Format = function(fmt) 
	{
	    //author: meizz 
	    var o =
	    { 
	        "M+" : this.getMonth() + 1, //月份 
	        "d+" : this.getDate(), //日 
	        "h+" : this.getHours(), //小时 
	        "m+" : this.getMinutes(), //分 
	        "s+" : this.getSeconds(), //秒 
	        "q+" : Math.floor((this.getMonth() + 3) / 3), //季度 
	        "S" : this.getMilliseconds() //毫秒 
	    }; 
	    if (/(y+)/.test(fmt)) 
	        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length)); 
	    for (var k in o) 
	        if (new RegExp("(" + k + ")").test(fmt)) 
	            fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length))); 
	    return fmt; 
	}
	Date.prototype.addDays = function(d)
	{
	    this.setDate(this.getDate() + d);
	};
	  Ext.BLANK_IMAGE_URL = '/msa/extjs/resources/images/default/s.gif';
		Ext.onReady(function(){
		//var portalColumnId = "row";
    // create some portlet tools using built in Ext tool ids
    var tools = [
    {
        id:'refresh',
        handler: function(event, toolEl, p){
        	//p.getUpdater().update({url: "ExtAjax.jsp", scripts: true});
          var panelid=p.id.substring(5);
          Ext.Ajax.request({
	          method : 'POST',
	          url:'/msa/main.xp',
	          success: function(response, options){
	          		//alert(response.responseText);
	          		var bd = Ext.getCmp('panel'+panelid).body;
						    //bd.update('').setStyle('background', '#fff');
						    bd.hide().update(response.responseText).slideIn('0', {stopFx:true,duration:.2});
	          },
	          failure : function(){
	          },
	        	params:{Fun:'msaiplogCv',num:panelid}
					});
        }
    }
//    {
//        id:'close',
//        handler: function(e, target, panel){
//            panel.ownerCt.remove(panel, true);
//        }
//    }
    ];
    var panelhight=225;
    var c0_r0 = new Ext.ux.Portlet({
						    xtype:'portlet',
						    id:'panel0',
						    margins:'10 0 0 0',
								title: '数据汇总',
								draggable:false,
								layout:'fit',
								height:panelhight,
								collapsible : false,
								collapsed:false,
		            tools: tools,
								items: []
    });
    var c0_r1 = new Ext.ux.Portlet({
					      xtype:'portlet',
					      id:'panel4',
					      margins:'10 0 0 0',
								title: '数据汇总',
								draggable:false,
								layout:'fit',
								height:panelhight,
								collapsible : false,
								collapsed:false,
			          tools: tools,
								items: []
    });

		var c0_r2=new Ext.ux.Portlet({
								xtype:'portlet',
					      id:'panel8',
					      margins:'10 0 0 0',
								title: '数据汇总',
								draggable:false,
								layout:'fit',
								height:panelhight,
								collapsible : false,
								collapsed:false,
							  tools: tools,
								items: []
       });
		var c0_r3=new Ext.ux.Portlet({
								xtype:'portlet',
					      id:'panel12',
					      margins:'10 0 0 0',
								title: '数据汇总',
								draggable:false,
								layout:'fit',
								height:panelhight,
								collapsible : false,
								collapsed:false,
							  tools: tools,
								items: []
		});
   	var col_0 = new Ext.ux.PortalColumn({
		       			columnWidth:.23,
		            style:'padding:10px 0 10px 10px',
		            items:[c0_r0,c0_r1,c0_r2,c0_r3]
   	});
    var c1_r0 = new Ext.ux.Portlet({
            xtype:'portlet',
				    id:'panel1',
				    margins:'10 0 0 0',
						title: '数据汇总',
						draggable:false,
						layout:'fit',
						height:panelhight,
						collapsible : false,
						collapsed:false,
						tools: tools,
						items: []
		});
		var c1_r1 = new Ext.ux.Portlet({
			      xtype:'portlet',
				    id:'panel5',
				    margins:'10 0 0 0',
						title: '数据汇总',
						draggable:false,
						layout:'fit',
						height:panelhight,
						collapsible : false,
						collapsed:false,
		        tools: tools,
						items: []
		});
		var c1_r2 = new Ext.ux.Portlet({
						xtype:'portlet',
						id:'panel9',
						margins:'10 0 0 0',
						title: '数据汇总',
						draggable:false,
						layout:'fit',
						height:panelhight,
						collapsible : false,
						collapsed:false,
		        tools: tools,
						items: []
		});
		var c1_r3 = new Ext.ux.Portlet({
				    xtype:'portlet',
				    id:'panel13',
				    margins:'10 0 0 0',
						title: '数据汇总',
						draggable:false,
						layout:'fit',
						height:panelhight,
						collapsible : false,
						collapsed:false,
		        tools: tools,
						items: []
		});
		var col_1 = new Ext.ux.PortalColumn({
                columnWidth:.24,
                style:'padding:10px 0 10px 10px',
                items:[c1_r0,c1_r1,c1_r2,c1_r3]
		});
		var c2_r0 = new Ext.ux.Portlet({
            xtype:'portlet',
				    id:'panel2',
				    margins:'10 0 0 0',
						title: '数据汇总',
						draggable:false,
						layout:'fit',
						height:panelhight,
						collapsible : false,
						collapsed:false,
						tools: tools,
						items: []
		});
		var c2_r1 = new Ext.ux.Portlet({
			        xtype:'portlet',
				      id:'panel6',
				      margins:'10 0 0 0',
							title: '数据汇总',
							draggable:false,
						  layout:'fit',
							height:panelhight,
							collapsible : false,
							collapsed:false,
		          tools: tools,
							items: []
		});
		var c2_r2 = new Ext.ux.Portlet({
				    xtype:'portlet',
				    id:'panel10',
				    margins:'10 0 0 0',
						title: '数据汇总',
						draggable:false,
						layout:'fit',
						height:panelhight,
						collapsible : false,
		        tools: tools,
						collapsed:false,
						items: []
		});
		var c2_r3 = new Ext.ux.Portlet({
				    xtype:'portlet',
				    id:'panel14',
				    margins:'10 0 0 0',
						title: '数据汇总',
						draggable:false,
						layout:'fit',
						height:panelhight,
						collapsible : false,
		        tools: tools,
						collapsed:false,
						items: []
		});
		var col_2 = new Ext.ux.PortalColumn({
              columnWidth:.24,
              style:'padding:10px 0 10px 10px',
              items:[c2_r0,c2_r1,c2_r2,c2_r3]
		});
		var c3_r0 = new Ext.ux.Portlet({
              xtype:'portlet',
				      id:'panel3',
				      margins:'10 0 0 0',
							title: '数据汇总',
							draggable:false,
							layout:'fit',
							height:panelhight,
							collapsible : false,
							collapsed:false,
							tools: tools,
							items: []
		});
		var c3_r1 = new Ext.ux.Portlet({
			        xtype:'portlet',
				      id:'panel7',
				      margins:'10 0 0 0',
							title: '数据汇总',
							draggable:false,
						  layout:'fit',
							height:panelhight,
							collapsible : false,
							collapsed:false,
		          tools: tools,
							items: []
		});
		var c3_r2 = new Ext.ux.Portlet({
				     xtype:'portlet',
				     id:'panel11',
				     margins:'10 0 0 0',
						 title: '数据汇总',
						 draggable:false,
						 layout:'fit',
						 height:panelhight,
						 collapsible : false,
						 collapsed:false,
		         tools: tools,
						 items: []
		});
		var c3_r3 = new Ext.ux.Portlet({
				     xtype:'portlet',
				     id:'panel15',
				     margins:'10 0 0 0',
						 title: '数据汇总',
						 draggable:false,
						 layout:'fit',
						 height:panelhight,
		         tools: tools,
						 collapsible : false,
						 collapsed:false,
						 items: []
		});
		var col_3 = new Ext.ux.PortalColumn({
                columnWidth:.24,
                style:'padding:10px 0 10px 10px',
                items:[c3_r0,c3_r1,c3_r2,c3_r3]
		});
		_portal = new Ext.ux.Portal({
				xtype:'portal',
				border: false,
        //region:'center',
        //margins:'35 5 5 0',
        items:[col_0,col_1,col_2,col_3]

        /*
         * Uncomment this block to test handling of the drop event. You could use this
         * to save portlet position state for example. The event arg e is the custom
         * event defined in Ext.ux.Portal.DropZone.
         */
        ,listeners: {
            'drop': function(e){
            //Ext.Msg.alert('aaa',dump_obj(this.items));
            //Ext.Msg.alert('aaa',dump_obj(this.items));
             //Ext.Msg.alert('aaa',dump_obj(e.portal));

                Ext.Msg.alert('Portlet Dropped', e.panel.title+':id:'+e.panel.id + '<br />Column: ' +
                  e.columnIndex + '<br />Position: ' + e.position);
            }
        }

		});
		var menu = new Ext.menu.Menu({
	    id: 'basicMenu',
	    items: [new Ext.menu.Item({
	            text: '浏览4天内数据',
	            handler: clickHandler1
	        }),
	        new Ext.menu.Item({
	            text: '浏览8天内数据',
	            handler: clickHandler2
	        }),
	        new Ext.menu.Item({
	            text: '浏览12天内数据',
	            handler: clickHandler3
	        }),
	        new Ext.menu.Item({
	            text: '浏览16天内数据',
	            handler: clickHandler4
	        }),
	        '-'
	    ]
		});
		function clickHandler1() {
				for(var k=0;k<16;k++){
					if(k>=4){
						var hidename='panel'+k;
						var bd = Ext.getCmp(hidename);
						bd.hide();
					}
				}
		}
		function clickHandler2() {
				for(var k=0;k<16;k++){
					var hidename='panel'+k;
					if(k>=8){
						var bd = Ext.getCmp(hidename);
						bd.hide();
					}else{
						var bd = Ext.getCmp(hidename);
						bd.show();
					}
				}
		}
		function clickHandler3() {
				for(var k=0;k<16;k++){
					var hidename='panel'+k;
					if(k>=12){
						var bd = Ext.getCmp(hidename);
						bd.hide();
					}else{
						var bd = Ext.getCmp(hidename);
						bd.show();
					}
				}
		}
		function clickHandler4() {
				for(var k=0;k<16;k++){
					var hidename='panel'+k;
					var bd = Ext.getCmp(hidename);
					bd.show();
				}
		}
		var mainpanel= new Ext.Panel({
				xtype:'portal',
				region: 'center',
    		height:screen.height,
        autoScroll:true,
        collapsible: true,
        split:true,
        layout:'fit',
        margins:'0 5 0 0',
        title: '数据中心',
        tbar:[{text:"选项",
        			pressed: true,
	            icon: '/msa/images/menu-show.gif',
	            enableToggle:true,
	            cls: 'x-btn-text-icon details',
        			menu:menu}],
        items:[_portal]        
		});
    var viewport = new Ext.Viewport({
        layout:'border',
        items:[mainpanel]
    });
    for(var j=0;j<16;j++){
			var myname='panel'+j;
			var now = new Date();
			now.addDays(-j);//加减日期操作
			Ext.getCmp(myname).setTitle(now.Format("yyyy-MM-dd")); 
    }
//    for (var j = 0; j <4; j++) {
//				var portalColumn = new Ext.ux.PortalColumn({
//						id : portalColumnId + j,
//						xtpye:'portal',
//						columnWidth :.44,
//						style : 'padding:2px 2px 2px 2px',
//						items:[]
//				});
//				Ext.getCmp("pp").add(portalColumn);
//				viewport.doLayout();
//				var newpanel = new Ext.Panel({
//						id:'dynamicpanel',
//						title: 'Panel 2',
//						renderTo:portalColumnId + j,
//						draggable:true,
//						tools: tools,
//						autoWidth:true,
//					  collapsible:true,
//					  width: 80,
//					  height:80,
//					  items:[{
//        				id:'pp',
//        				xtype:'portal',
//                columnWidth:.44,
//                style:'padding:10px 0 10px 10px',
//                items:[]
//            }]
//				});
//				newpanel.doLayout();
//				portalColumn.add("dynamicpanel");
////				alert(Ext.getCmp("staticpanel").ownerCt);
////				alert(Ext.getCmp("dynamicpanel").ownerCt);
//	  }
});
</SCRIPT>
</head>
<script type="text/javascript" src="/msa/extjs/Portlet.js"></script>
<body bgcolor="#FFFFFF" topmargin=0 leftmargin=0 style="SCROLLBAR-FACE-COLOR: #f0f0f0;  overflow-x:hidden;  OVERFLOW: scroll; SCROLLBAR-SHADOW-COLOR: #f0f0f0; SCROLLBAR-3DLIGHT-COLOR: #f0f0f0; SCROLLBAR-ARROW-COLOR: #f0f0f0; SCROLLBAR-DARKSHADOW-COLOR: #cccccc;" >
<div id="menubutton"></div>
<script type='text/javascript'>
	function loop(n){
		if(n<16){
			var panelname='panel'+n;
			Ext.Ajax.request({
	          method : 'POST',
	          url:'/msa/main.xp',
	          success: function(response, options){
	          		var bd = Ext.getCmp(panelname).body;
						    //bd.update('').setStyle('background', '#fff');
						    bd.hide().update(response.responseText).slideIn('0', {stopFx:true,duration:.2});
		          	n++
		          	loop(n);
	          },
	          failure : function(){
	          },
	        	params:{Fun:'msaiplogCv',num:n}
			});
		}
		return -1;
	}
	loop(0);
</script>
</body>
</html>