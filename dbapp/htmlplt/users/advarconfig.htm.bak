<HTML><HEAD><TITLE>网络7层管理和过滤的领导者</TITLE>
<META content="text/html; charset=utf-8" http-equiv=Content-Type>
<LINK rel=stylesheet type=text/css href="/msa/publiccss/pubcss.css">
<LINK rel=stylesheet type=text/css href="/msa/extjs/resources/css/ext-all.css">
<link rel="stylesheet" type="text/css" href="/msa/extjs/resources/css/feed-viewer.css" />
<LINK rel=stylesheet type=text/css href="/msa/extjs/resources/css/xtheme-default.css" id="xthemecss" >
<script type="text/javascript" src="/msa/extjs/adapter/ext/ext-base.js"></script>
<SCRIPT type=text/javascript  src="/msa/extjs/ext-all.js"></SCRIPT>
<script type=text/javascript  src="/msa/publicjs/exportexcel.js"></script>
<STYLE type=text/css>HTML {
	BORDER-BOTTOM: 0px; BORDER-LEFT: 0px; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-LEFT: 0px; PADDING-RIGHT: 0px; FONT: 12px verdana; HEIGHT: 100%; OVERFLOW: hidden; BORDER-TOP: 0px; BORDER-RIGHT: 0px; PADDING-TOP: 0px
}
BODY {
	BORDER-BOTTOM: 0px; BORDER-LEFT: 0px; PADDING-BOTTOM: 0px; MARGIN: 0px; PADDING-LEFT: 0px; PADDING-RIGHT: 0px; FONT: 12px verdana; HEIGHT: 100%; OVERFLOW: hidden; BORDER-TOP: 0px; BORDER-RIGHT: 0px; PADDING-TOP: 0px
}
P {
	MARGIN: 5px
}
</STYLE>

<SCRIPT LANGUAGE="JavaScript">


function update() {
  listform.action.value="1";
	listform.submit();
}

function update0() {
  listform.action.value="0";
	listform.submit();
}

Ext.BLANK_IMAGE_URL = '/msa/extjs/resources/images/default/s.gif';

Ext.onReady(function(){
	
						Ext.QuickTips.init();

						var detailEl;
						var mainViewEl;
						
						var myMask = new Ext.LoadMask(Ext.getBody(), 
				    {
				        	msg:"Please wait..."
				    });
						myMask.show();
           
					  var contentPanel = {
							id: 'content-panel',
							region: 'center', // this is what makes this panel into a region within the containing layout
							margins: '0 0 0 0',
							activeItem: 0,
							border: false,
							el:'mainviewdiv'
						};
						
						 var treepan=new Ext.tree.TreePanel({
										    	  id: 'tree-panel',
										        region:'center',
										        split: true,
										        useArrows:true,
										        title: 'AD结构列表',
										        autoScroll: true,
										        rootVisible: false,
										        lines: false,
										        useArrows: true,
										        loader: new Ext.tree.TreeLoader({
										            dataUrl:'/msa/main.xp?Fun=ltadtree',
																baseParams:{Fun:'ltadtree'} 
										        }),
										        root: new Ext.tree.AsyncTreeNode()
						});
					  
					 
					   var rightClick  = new Ext.menu.Menu({
                id:'feeds-ctx',
                items: [{
                    id:'shanchubaogao',
                    iconCls:'load-icon',
                    text:'同步全部用户',
                    scope: this,
                    handler:function(){
                           Ext.MessageBox.show({
																		msg: '正在同步中，这需要一段时间。。',
																		progressText: 'waitting...',
																		width:300,
																		wait:true,
																		waitConfig: {interval:500},
																		icon:'ext-mb-download'
														});
														Ext.Ajax.request({
						                      method : 'POST', 
						                      url:'/main/main.xp', 
					                        success: function(response, options) { 
																		Ext.MessageBox.hide();
																		Ext.MessageBox.alert('提示',response.responseText); 
					                        },
					                        failure : function() {
					                          Ext.MessageBox.hide();      
					                         	Ext.MessageBox.alert('提示','同步失败！'); 
                                  },
 					                        params:{
	 					                        Fun:'nasinportaduser'
 					                        } 
														});  
                    }
                },{
                    id:'chakan',
                    iconCls:'load-icon',
                    text:'同步本区域的用户',
                    scope: this,
                    handler:function(){
                           Ext.MessageBox.show({
																		msg: '正在同步中，这需要一段时间。。',
																		progressText: 'waitting...',
																		width:300,
																		wait:true,
																		waitConfig: {interval:500},
																		icon:'ext-mb-download'
														});
														Ext.Ajax.request({
						                      method : 'POST', 
						                      url:'/main/main.xp', 
					                        success: function(response, options) { 
																		Ext.MessageBox.hide();
																		Ext.MessageBox.alert('提示',response.responseText); 
					                        },
					                        failure : function() {
					                          Ext.MessageBox.hide();      
					                         	Ext.MessageBox.alert('提示','同步失败！'); 
                                  },
 					                        params:{
	 					                        Fun:'nasinportaduser',
	 					                        bdn:detailEl
 					                        } 
														}); 
                    }
                }]
				     });
                
					  
					 treepan.addListener('click', rightClickFn);
					 treepan.addListener('contextmenu', rightClickFn);
			     function rightClickFn(n,  e) {      
					       if(!n.leaf ){
								   detailEl=n.id;
									 rightClick.showAt(e.getXY()); 
					    	}
			     }   

					  
						var westPanel ={
                    title:' ',
                    width:400,
                    minSize: 125,
                    maxSize: 400,
        						collapsible: true,
        						cmargins:'0 5 5 5',
						        lines:false,
						        autoScroll:true,
						        collapseFirst:false,
								    layout: 'fit',
						    	  id: 'layout-browser',
						        region:'west',
						        border: false,
						        split:true,
						        title: '参数配置',
								    margins: '2 0 5 5',
								    items: [{
											el: 'north'
										}],tbar: [{
						            icon:'/extjs/resources/images/default/tree/member.gif',
						            iconCls:'drop-add',						            
						            text:'保存参数并显示结构',
						            handler: function(){
						               var myldaphost=listform.ldaphost.value;
						               var mydomain=listform.domain.value;
						               var myldapadmin=listform.ldapadmin.value;
						               var myldappass=listform.ldappass.value;
						               var myldapbasedn=listform.ldapbasedn.value;
						                
						               var ids = document.getElementsByName("updatead");
						               var stopflag;
						               var myupdatead;
						               myupdatead="0";
						               if(ids[0].checked == true){
						               		myupdatead="1";
						               }	
						               stopflag=0;	               
						               Ext.MessageBox.show({
																		msg: '参数正在设置中，由于要重新启动域链接服务，这需要一段时间。。',
																		progressText: 'waitting...',
																		width:300,
																		wait:true,
																		waitConfig: {interval:500},
																		icon:'ext-mb-download'
														});
														Ext.Ajax.request({
						                      method : 'POST', 
						                      url:'/main/main.xp', 
					                        success: function(response, options) { 
																		if(stopflag==0){
																		  treepan.getLoader().load(treepan.root);
																			Ext.MessageBox.hide();
																		}
																		stopflag=1;
					                        },
					                        failure : function() {
					                          Ext.MessageBox.hide();      
					                         	Ext.MessageBox.alert('提示','参数配置失败！'); 
                                  },
 					                        params:{
	 					                        Fun:'ltadvarconfigok',
	 					                        ldaphost:myldaphost,
	 					                        domain:mydomain,
	 					                        ldapadmin:myldapadmin,
	 					                        ldappass:myldappass,
	 					                        updatead:myupdatead,
	 					                        ldapbasedn:myldapbasedn
 					                        } 
														});   
						               //var  myurl="/main/main.xp?Fun=ltadvarconfigok+ldaphost=" + myldaphost + "+domain=" + mydomain + "+ldapadmin=" + myldapadmin
						               // + "+ldappass=" + myldappass + "+updatead=" + myupdatead + "+ldapbasedn=" + myldapbasedn;
						               //Ext.MessageBox.alert('提示',myurl);
						               //mybasefrm.location.href=myurl;
						            },
						            scope: this
						        },
						    		{xtype:"tbfill"},{
						            icon:'/images/table_refresh.png',
						            iconCls:'drop-add',						            
						            text:'刷新显示结构',
						            handler: function(){
														treepan.getLoader().load(treepan.root);
												},
						            scope: this
						        }
						    ]
						};
						
						// Finally, build the main layout once all the pieces are ready.  This is also a good
						// example of putting together a full-screen BorderLayout within a Viewport.
					    new Ext.Viewport({
									layout: 'border',
									bbar: new Ext.StatusBar({
								      id: 'centerstatus',
                      defaultText: 'Ready',
                      defaultIconCls: 'default-icon',
                      iconCls: 'ready-icon'
                  }),
									items: [
									  westPanel,
										treepan
									],
					        renderTo: Ext.getBody()
					    });
             
            myMask.hide();
  });

</SCRIPT>

</head>
<body bgcolor="#f0f0f0" text="#000000" topmargin="2">

<DIV id=north>

<form name="listform" action="/main/main.xp" method="POST">
<input type="hidden" name="Fun" value="">
<input type="hidden" name="depfield" value="group" >
<input type="hidden" name="policyfield" value="ou" >
<table width="80%" border="0">
  <tr> 
    <td valign="top"> 

       <table  border="0" align="left">
    
            <tr> 
            <td >AD域服务器IP：</td> 
           </tr>
           
           <tr> 
            <td ><input type="text" name="ldaphost" value="[$ldaphost$]"  class="inputf0" ></td>
           </tr>
           
           <tr> 
            <td >AD域名称：</td>
          </tr>
          <tr> 
            <td ><input type="text" name="domain" value="[$domain$]"  class="inputf0"  size=30 ></td>
          </tr>
      
           <tr> 
            <td >具备管理权限的帐号和密码：</td>
           
            </tr>
            
            <tr> 
            <td ><input type="text"  name="ldapadmin" value="[$ldapadmin$]"  class="inputf0"  size=55 ></td>
            
            </tr>
            
            <tr> 
            <td ><input type="password" name="ldappass" value="[$ldappass$]"  class="inputf0" ></td>
           
            </tr>
            <tr> 
            <td >基础管理范围（BaseDN）：</td>
            
            </tr>
            
            <tr> 
            <td ><input type="text" name="ldapbasedn"  size=40 value="[$ldapbasedn$]"  class="inputf0" ></td>
           
            </tr>
            
           <tr> 
            <td ><input type="checkbox" id="updatead"  name="updatead" value="1"  class="inputf0"  [$updatechk$]  >同步域OU和GROUP，对应金盾的部门和策略组</td>
            
          </tr>
        </table>  
    </td>
  </tr>
  
</table>
</form>
</DIV>
<div id="mainviewdiv">
<iframe id="mybasefrm"  name="mybasefrm" src="/main/adtree.htm" width="102%" height="550" border="0" frameborder="0"  ></iframe>
</div>
</body>
</html>
